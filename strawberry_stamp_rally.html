<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>å²¡å±±å¸‚ã‚µã‚¦ã‚¹ãƒ´ã‚£ãƒ¬ãƒƒã‚¸ - ã„ã¡ã”ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
  <style>
    :root{--accent:#e53935;--bg:#fff;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,Arial;line-height:1.5;margin:0;background:linear-gradient(#fff,#fff);color:#111;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    .logo{width:64px;height:64px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    main{max-width:820px;margin:18px auto}
    h1{font-size:1.4rem;margin:8px 0}
    .lead{color:var(--muted);margin-bottom:12px}
    .card{border-radius:12px;padding:14px;border:1px solid #eee;margin:10px 0;background:#fafafa}
    .stamps{display:flex;gap:10px;flex-wrap:wrap}
    .stamp{width:120px;height:120px;border-radius:10px;border:2px dashed #eee;display:flex;align-items:center;justify-content:center;flex-direction:column}
    .got{border-style:solid;background:linear-gradient(180deg,#fff7f7,#ffecec)}
    .big{font-size:1.05rem;font-weight:700;color:var(--accent)}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;text-decoration:none}
    footer{font-size:0.85rem;color:var(--muted);margin-top:18px}
    .hint{font-size:0.95rem;color:var(--muted)}
    .qr-list{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    pre{white-space:pre-wrap;word-break:break-word;background:#fff;padding:8px;border-radius:6px;border:1px solid #eee}
    @media(max-width:520px){.stamp{width:48%;height:100px}}
  </style>
</head>
<body>
<header>
  <div class="logo">SV</div>
  <div>
    <div style="font-size:0.95rem;color:var(--muted)">å²¡å±±å¸‚ã‚µã‚¦ã‚¹ãƒ´ã‚£ãƒ¬ãƒƒã‚¸</div>
    <div style="font-weight:700">åšå£«ã¨ãƒ•ãƒ«ãƒ¼ãã‚“ã®ã„ã¡ã”ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</div>
  </div>
</header>
<main>
  <section class="card">
    <p class="lead">ã‚¹ãƒãƒ›ã§QRã‚’èª­ã¿å–ã£ã¦ã€åœ’å†…5ã‹æ‰€ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚ˆã†ã€‚ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã™ã‚‹ã¨å½“æ—¥é™ã‚Šã®ç‰¹å…¸ãŒã‚‚ã‚‰ãˆã¾ã™ã€‚</p>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <a class="btn" id="btn-progress" href="?page=progress">ã‚¹ã‚¿ãƒ³ãƒ—çŠ¶æ³ã‚’ç¢ºèª</a>
      <a class="btn" id="btn-reset" href="#" style="background:#757575">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ãƒªã‚»ãƒƒãƒˆ</a>
    </div>
    <p class="hint">â€»æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶(localStorage)ã«ä¿å­˜ã—ã¾ã™ã€‚ç«¯æœ«ã‚’å¤‰ãˆã‚‹ã¨å¼•ãç¶™ã’ã¾ã›ã‚“ã€‚</p>
  </section>

  <section class="card" id="point-area" style="display:none">
    <div id="point-message" class="big"></div>
    <p id="point-description" class="hint"></p>
    <div style="margin-top:10px"><a id="goto-progress" class="btn" href="?page=progress">é€²æ—ã‚’è¦‹ã‚‹</a></div>
  </section>

  <section class="card" id="progress-area" style="display:none">
    <h2>ç¾åœ¨ã®ã‚¹ã‚¿ãƒ³ãƒ—çŠ¶æ³</h2>
    <div id="stamps" class="stamps"></div>
    <div id="complete-area" style="margin-top:12px"></div>
  </section>

  <section class="card">
    <h3>ç®¡ç†è€…ãƒ¡ãƒ¢ï¼ˆQRã®ç”Ÿæˆãƒ»è¨­ç½®ï¼‰</h3>
    <p class="hint">å„ã‚¹ãƒãƒƒãƒˆç”¨ã®URLã¯æ¬¡ã®å½¢å¼ã§ã™ï¼ˆå…¬é–‹ã—ãŸãƒšãƒ¼ã‚¸ã®URLãŒ <code>https://example.com/stamp.html</code> ã ã¨ä»®å®šï¼‰ã€‚</p>
    <pre>ãƒã‚¦ã‚¹å…¥å£: https://example.com/stamp.html?point=1
ãƒ‰ãƒ¼ãƒŠãƒ„åº—: https://example.com/stamp.html?point=2
ã‚¸ãƒ¥ãƒ¼ã‚¹åº—: https://example.com/stamp.html?point=3
ãƒ‘ãƒ³å·¥æˆ¿: https://example.com/stamp.html?point=4
ãƒãƒ¼ã‚±ãƒƒãƒˆ: https://example.com/stamp.html?point=5</pre>
    <p class="hint">ã“ã®URLã‚’QRã«å¤‰æ›ã—ã¦å„ã‚¹ãƒãƒƒãƒˆã«æ²ç¤ºã—ã¦ãã ã•ã„ã€‚</p>
    <div style="margin-top:8px">
      <div style="font-weight:700">QRè¨­ç½®ã®ã‚³ãƒ„</div>
      <ul>
        <li>é«˜ã•ã¯ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ä½ç½®ï¼ˆæ‰‹æŒã¡ï¼‰ã«åˆã‚ã›ã‚‹ï¼ˆèƒ¸ã‹ã‚‰ç›®ç·šï¼‰</li>
        <li>QRã®ä¸‹ã«çŸ­ã„æŒ‡ç¤ºæ–‡ï¼ˆä¾‹ï¼šã€ŒQRã‚’èª­ã¿å–ã£ã¦ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç²å¾—ã€ï¼‰ã‚’è¿½åŠ </li>
        <li>è¨€èªå¯¾å¿œã¯å°†æ¥è¿½åŠ äºˆå®šãªã‚‰ã€å›½æ——ã‚¢ã‚¤ã‚³ãƒ³ã§åˆ¥QRã‚’ä¸¦ã¹ã‚‹</li>
      </ul>
    </div>
  </section>

  <footer>
    <div>ä½œæˆ: å²¡å±±å¸‚ã‚µã‚¦ã‚¹ãƒ´ã‚£ãƒ¬ãƒƒã‚¸ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</div>
  </footer>
</main>

<script>
// --- è¨­å®š ---
const SPOTS = [
  {id: '1', title: 'ãƒã‚¦ã‚¹å…¥å£', desc: 'ã“ã“ãŒè‹ºãƒã‚¦ã‚¹å…¥å£ã€‚æ—¥ç…§ã¨æ°´ç®¡ç†ã§å‘³ãŒå¤‰ã‚ã‚‹ãã€‚'},
  {id: '2', title: 'ãƒ‰ãƒ¼ãƒŠãƒ„åº—', desc: 'æ¡ã‚ŒãŸã¦è‹ºã‚’ãƒˆãƒƒãƒ”ãƒ³ã‚°ã—ãŸé™å®šãƒ‰ãƒ¼ãƒŠãƒ„ã‚ã‚Šã€‚'},
  {id: '3', title: 'ã‚¸ãƒ¥ãƒ¼ã‚¹åº—', desc: 'ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¸ãƒ¥ãƒ¼ã‚¹ã§è‹ºã®ç”˜ã¿ã‚’æ¯”è¼ƒã—ã‚ˆã†ã€‚'},
  {id: '4', title: 'ãƒ‘ãƒ³å·¥æˆ¿', desc: 'ãƒ‘ãƒ³å±‹ã®è‹ºã‚µãƒ³ãƒ‰ã‚’å‘³ã‚ã†ã‚³ãƒ¼ãƒŠãƒ¼ã€‚'},
  {id: '5', title: 'ãƒãƒ¼ã‚±ãƒƒãƒˆ', desc: 'ãƒ•ã‚¡ãƒ¼ãƒãƒ¼ã‚ºãƒãƒ¼ã‚±ãƒƒãƒˆã§åœ°å…ƒç”£ã‚’ãƒã‚§ãƒƒã‚¯ã€‚'}
];
const STORAGE_KEY = 'sv_stamps_v1'; // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ç”¨
// ----------------

function todayISO(){
  const d = new Date();
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,'0')+"-"+String(d.getDate()).padStart(2,'0');
}

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return {date: todayISO(), stamps: []};
    const obj = JSON.parse(raw);
    if(obj.date !== todayISO()) return {date: todayISO(), stamps: []};
    return obj;
  }catch(e){
    return {date: todayISO(), stamps: []};
  }
}

function saveState(state){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function addStamp(id){
  const state = loadState();
  if(!state.stamps.includes(id)){
    state.stamps.push(id);
    saveState(state);
    return true;
  }
  return false;
}

function resetStamps(){
  const state = {date: todayISO(), stamps: []};
  saveState(state);
}

function getStamps(){
  return loadState().stamps || [];
}

// URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¤å®š
const params = new URLSearchParams(location.search);
const point = params.get('point');
const page = params.get('page');

// è¦ç´ 
const pointArea = document.getElementById('point-area');
const progressArea = document.getElementById('progress-area');
const pointMessage = document.getElementById('point-message');
const pointDescription = document.getElementById('point-description');
const stampsContainer = document.getElementById('stamps');
const completeArea = document.getElementById('complete-area');
const btnReset = document.getElementById('btn-reset');

btnReset.addEventListener('click',(e)=>{e.preventDefault();if(confirm('ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿï¼ˆå½“æ—¥ã®ã¿ï¼‰')){resetStamps();alert('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');location.href='?page=progress'}})

if(point){
  // ã‚¹ã‚¿ãƒ³ãƒ—å–å¾—å‡¦ç†
  const spot = SPOTS.find(s=>s.id===point);
  if(spot){
    const added = addStamp(point);
    pointArea.style.display='block';
    pointMessage.textContent = added ? `ğŸ“ ã‚¹ã‚¿ãƒ³ãƒ—ã€Œ${spot.title}ã€ã‚’ç²å¾—ã—ã¾ã—ãŸï¼` : `âœ… æ—¢ã«ã‚¹ã‚¿ãƒ³ãƒ—ã€Œ${spot.title}ã€ã¯ç²å¾—æ¸ˆã¿ã§ã™`;
    pointDescription.textContent = spot.desc;
  } else {
    pointArea.style.display='block';
    pointMessage.textContent = 'ä¸æ˜ãªãƒã‚¤ãƒ³ãƒˆã§ã™';
    pointDescription.textContent = '';
  }
}

if(page==='progress' || !point && !page){
  progressArea.style.display='block';
  renderProgress();
}

function renderProgress(){
  stampsContainer.innerHTML='';
  const have = getStamps();
  SPOTS.forEach(s=>{
    const el = document.createElement('div');
    el.className='stamp'+(have.includes(s.id)?' got':'');
    el.innerHTML = `<div style="font-weight:700">${s.title}</div><div style="font-size:0.9rem;color:var(--muted)">`+(have.includes(s.id)?'ç²å¾—æ¸ˆ':'æœªå–å¾—')+`</div>`;
    stampsContainer.appendChild(el);
  });
  // ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆåˆ¤å®š
  if(have.length >= SPOTS.length){
    completeArea.innerHTML = `<div class="big">ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</div><p class="hint">ã“ã®ç”»é¢ã‚’æç¤ºã™ã‚‹ã¨ã€ãƒ‰ãƒ¼ãƒŠãƒ„åº—ã§é™å®šç‰¹å…¸ãŒå—ã‘ã‚‰ã‚Œã¾ã™ï¼ˆæœ¬æ—¥é™ã‚Šï¼‰ã€‚</p>`;
  } else {
    completeArea.innerHTML = `<p class="hint">ã‚ã¨ ${SPOTS.length - have.length} ã‹æ‰€ã§ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã§ã™ã€‚</p>`;
  }
}

// åˆæœŸè¡¨ç¤ºï¼ˆQRä¸€è¦§ã‚’ä¸‹ã«è¡¨ç¤ºã™ã‚‹ã¨ä¾¿åˆ©ï¼‰
(function showQRList(){
  // ç®¡ç†è€…å‘ã‘ã«QRä¸€è¦§ã‚’è¡¨ç¤ºï¼ˆå…¬é–‹æ™‚ã¯å‰Šã£ã¦OKï¼‰
  const area = document.createElement('div');
  area.className='card';
  area.innerHTML = `<h3>QRä¸€è¦§ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰</h3><div class="qr-list" id="qr-list"></div>`;
  document.querySelector('main').appendChild(area);
  const list = document.getElementById('qr-list');
  const base = location.origin + location.pathname; // stamp.html ã¨ã—ã¦é…ç½®ã•ã‚Œã‚‹æƒ³å®š
  SPOTS.forEach(s=>{
    const a = document.createElement('div');
    a.innerHTML = `<div style="font-weight:700">${s.title}</div><div style="font-size:0.9rem;color:var(--muted)">${base}?point=${s.id}</div>`;
    list.appendChild(a);
  });
})();

</script>
</body>
</html>
